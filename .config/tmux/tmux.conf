##### Basics #####

# Use Ctrl-a instead of Ctrl-b (classic, easier to reach)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Faster key response
set -sg escape-time 0

# More scrollback history
set -g history-limit 200000

# Start window/pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable mouse: pane selection, resize, scrolling, window switching
set -g mouse on

# Truecolor + sane TERM
# - Ghostty supports truecolor. tmux can pass it through.
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB"
set -as terminal-features ",tmux-256color:RGB"
set -as terminal-features ",ghostty:RGB"

# If you ssh into machines that don't know tmux-256color, you can change to:
# set -g default-terminal "screen-256color"
# (But on Arch, install terminfo for tmux-256color; see section 4)

##### Quality-of-life keybinds #####

# Reload config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux config reloaded!"

# Split panes (more intuitive keys)
unbind %
unbind '"'
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Navigate panes with arrow keys
bind Left select-pane -L
bind Down select-pane -D
bind Up select-pane -U
bind Right select-pane -R

# Check if current pane is running Neovim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?)(diff)?$'"

# Resize panes with Alt + arrows (pass through to Neovim if running)
bind -n M-Left if-shell "$is_vim" 'send-keys M-Left' 'resize-pane -L 5'
bind -n M-Down if-shell "$is_vim" 'send-keys M-Down' 'resize-pane -D 5'
bind -n M-Up if-shell "$is_vim" 'send-keys M-Up' 'resize-pane -U 5'
bind -n M-Right if-shell "$is_vim" 'send-keys M-Right' 'resize-pane -R 5'

# Quick window switching with Shift+Left/Right
bind -n S-Left previous-window
bind -n S-Right next-window

bind c new-window -c "#{pane_current_path}"

##### Clipboard / Copy mode #####

# Use vi-style keys in copy mode
setw -g mode-keys vi

# In copy-mode-vi:
# - v begins selection
# - y copies selection (and keeps selection behavior simple)
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# Try to integrate with system clipboard via OSC52 (works great over SSH too in many terminals)
# Requires tmux 3.2+ (common on Arch). If this causes issues, you can remove it.
set -g set-clipboard on

##### Visuals / status bar (clean + readable) #####

# Status bar refresh
set -g status-interval 2

# Basic status colors (kept minimal)
set -g status-style "bg=default,fg=colour8"
set -g message-style "bg=default,fg=colour15"
set -g pane-border-style "fg=colour8"
set -g pane-active-border-style "fg=colour10"

# Left: session name
set -g status-left-length 40
set -g status-left "#[fg=colour10]#S#[default] "

# Right: date/time
set -g status-right-length 80
set -g status-right "#[fg=colour8]%Y-%m-%d #[fg=colour15]%H:%M#[default]"

# Windows list style
setw -g window-status-style "fg=colour8"
setw -g window-status-current-style "fg=colour15,bold"
setw -g window-status-format " #I:#W "
setw -g window-status-current-format " #I:#W "

##### Safer defaults #####

# Donâ€™t close panes instantly if something exits; show a message
set -g remain-on-exit on

# TPM Plugin Manager
set -g @plugin "tmux-plugins/tpm"

# Session persistence
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"

# Initialize TPM (keep at bottom)
run "~/.config/tmux/plugins/tpm/tpm"
